"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4910],{3905:(n,e,a)=>{a.d(e,{Zo:()=>l,kt:()=>u});var r=a(7294);function o(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}function t(n,e){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.push.apply(a,r)}return a}function s(n){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?t(Object(a),!0).forEach((function(e){o(n,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))}))}return n}function i(n,e){if(null==n)return{};var a,r,o=function(n,e){if(null==n)return{};var a,r,o={},t=Object.keys(n);for(r=0;r<t.length;r++)a=t[r],e.indexOf(a)>=0||(o[a]=n[a]);return o}(n,e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);for(r=0;r<t.length;r++)a=t[r],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(n,a)&&(o[a]=n[a])}return o}var m=r.createContext({}),p=function(n){var e=r.useContext(m),a=e;return n&&(a="function"==typeof n?n(e):s(s({},e),n)),a},l=function(n){var e=p(n.components);return r.createElement(m.Provider,{value:e},n.children)},d="mdxType",c={inlineCode:"code",wrapper:function(n){var e=n.children;return r.createElement(r.Fragment,{},e)}},M=r.forwardRef((function(n,e){var a=n.components,o=n.mdxType,t=n.originalType,m=n.parentName,l=i(n,["components","mdxType","originalType","parentName"]),d=p(a),M=o,u=d["".concat(m,".").concat(M)]||d[M]||c[M]||t;return a?r.createElement(u,s(s({ref:e},l),{},{components:a})):r.createElement(u,s({ref:e},l))}));function u(n,e){var a=arguments,o=e&&e.mdxType;if("string"==typeof n||o){var t=a.length,s=new Array(t);s[0]=M;var i={};for(var m in e)hasOwnProperty.call(e,m)&&(i[m]=e[m]);i.originalType=n,i[d]="string"==typeof n?n:o,s[1]=i;for(var p=2;p<t;p++)s[p]=a[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}M.displayName="MDXCreateElement"},7670:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>m,contentTitle:()=>s,default:()=>d,frontMatter:()=>t,metadata:()=>i,toc:()=>p});var r=a(7462),o=(a(7294),a(3905));const t={},s="MSCHXML.PRW",i={unversionedId:"Fontes/mschxml",id:"Fontes/mschxml",title:"MSCHXML.PRW",description:"Importa\xe7\xe3o de XML",source:"@site/docs/2-Fontes/mschxml.md",sourceDirName:"2-Fontes",slug:"/Fontes/mschxml",permalink:"/docushark/docs/Fontes/mschxml",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"MPRCAUTORRAD.PRW",permalink:"/docushark/docs/Fontes/mprcautorrad"},next:{title:"MX181.PRW",permalink:"/docushark/docs/Fontes/mx181"}},m={},p=[{value:"<strong>Dados da Customiza\xe7\xe3o</strong>",id:"dados-da-customiza\xe7\xe3o",level:3},{value:"<strong>Especifica\xe7\xe3o da Customiza\xe7\xe3o</strong>",id:"especifica\xe7\xe3o-da-customiza\xe7\xe3o",level:3},{value:"<strong>Especifica\xe7\xf5es das Fun\xe7\xf5es e Rotinas</strong>",id:"especifica\xe7\xf5es-das-fun\xe7\xf5es-e-rotinas",level:3},{value:"<strong>Configura\xe7\xf5es dos JOBS por completo</strong>",id:"configura\xe7\xf5es-dos-jobs-por-completo",level:3},{value:"<strong>Funcionamento</strong>",id:"funcionamento",level:3}],l={toc:p};function d(n){let{components:e,...t}=n;return(0,o.kt)("wrapper",(0,r.Z)({},l,t,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"mschxmlprw"},"MSCHXML.PRW"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Importa\xe7\xe3o de XML")),(0,o.kt)("h3",{id:"dados-da-customiza\xe7\xe3o"},(0,o.kt)("strong",{parentName:"h3"},"Dados da Customiza\xe7\xe3o")),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Analista: Jonathan Torioni"),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"especifica\xe7\xe3o-da-customiza\xe7\xe3o"},(0,o.kt)("strong",{parentName:"h3"},"Especifica\xe7\xe3o da Customiza\xe7\xe3o")),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Est\xe1 customiza\xe7\xe3o tem o objetivo de realizar a importa\xe7\xe3o de XML's emitidos contra os cnpjs da filiais realicionadas ao Grupo Shark."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Separador Master")," - O separador master \xe9 a defini\xe7\xe3o dada a fun\xe7\xe3o ",(0,o.kt)("strong",{parentName:"p"},"U_MSCHXML()"),", onde realizar\xe1 as valida\xe7\xf5es iniciais e ir\xe1 destinar os XML para as respectivas pastas de cada empresa."),(0,o.kt)("p",null,"Caso o Separador Master identifique que o XML \xe9 um CTE, \xe9 ir\xe1 enviar o XML para a pasta ",(0,o.kt)("strong",{parentName:"p"},"\\interf\\tse\\CTE"),". Caso ele identifique que \xe9 uma NFE, realizar\xe1 a valida\xe7\xe3o do XML na base de dados."),(0,o.kt)("p",null,"A valida\xe7\xe3o do XML na base de dados consistem em verificar se a nota foi emitida com destino a algum CNPJ das filiais cadastradas no sistema, dessa forma, ele ir\xe1 direcionar o XML para a pasta ",(0,o.kt)("strong",{parentName:"p"},"\\interf\\tse\\descartados")," caso o XML j\xe1 tenha sido importado anteriormente na base. Caso o XML n\xe3o conste na base, ele ser\xe1 direcionado para a pasta ",(0,o.kt)("strong",{parentName:"p"},"\\interf\\tse\\EMPRESA_XX")," onde XX \xe9 o c\xf3digo da empresa em quest\xe3o."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Pr\xe9-separador")," - O pr\xe9-separador foi desenvolvido para fazer algumas an\xe1lises espec\xedficas nos XML da empresa em que ele est\xe1 configurado."),(0,o.kt)("p",null,"As valida\xe7\xf5es s\xe3o referente a datas de emiss\xe3o e conte\xfado do XML. Dessa forma, \xe9 garantido que os XML que ser\xe3o importados no sistema, est\xe3o 100% integros. Caso o XML esteja nos padr\xf5es para importa\xe7\xe3o, este \xe9 direcionado para a pasta ",(0,o.kt)("strong",{parentName:"p"},"\\interf\\tse\\EMPRESA_XX\\aprovados"),", caso contr\xe1rio, \xe9 destinado a pasta ",(0,o.kt)("strong",{parentName:"p"},"\\interf\\tse\\EMPRESA_XX\\falhas"),"."),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"especifica\xe7\xf5es-das-fun\xe7\xf5es-e-rotinas"},(0,o.kt)("strong",{parentName:"h3"},"Especifica\xe7\xf5es das Fun\xe7\xf5es e Rotinas")),(0,o.kt)("hr",null),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"U_MSCHXML()")," - Separador Mestre de XML, tem como finalidade, verificar se o XML j\xe1 encontra-se na base e/ou validar se o mesmo \xe9 uma NFE/CTE emitida contra alguma filial das empresas."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"U_MVLDCH()")," - Fun\xe7\xe3o respons\xe1vel por verificar se a nota j\xe1 foi importada anteriormente no sistema. "),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"U_MRETCDEMP()")," - Retorna o c\xf3digo da empresa filial com base no cnpj informado. Essa fun\xe7\xe3o foi desenvolvida para n\xe3o ser necess\xe1rio realizar uma conex\xe3o RPC durante a execu\xe7\xe3o do separador mestre."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"FGetObjXml(_clArq,_clDRaiz)")," - Retorna o objeto XML com base nos par\xe2metros informados, _clArq = Nome do arquivo |        _clDRaiz     = Diretorio do local raiz"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"MCONNEC(lConnec)")," - Realiza a conex\xe3o com o banco de dados. Fun\xe7\xe3o desenvolvida para realizar a conex\xe3o com o banco de dados, evitando assim utilizar a fun\xe7\xe3o RPCSetEnv(). lConnec - .T. connecta o banco, .F. finaliza a conex\xe3o."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"U_MSCHVAL2(_cEmp)")," - Pr\xe9-validador, 2\xba micro servi\xe7o, respons\xe1vel pela valida\xe7\xe3o dos XML que foram separados pelo Separador Mestre."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"DtImpProtheus(cEmpImp,cFilImp)")," - Retorna se a data de emissao \xe9 v\xe1lida para importar XML."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"MFALHA(_cEmp, _cFile, _cSFile)")," - Destina o XML para a pasta de falhas da empresa espec\xedficada. Fun\xe7\xe3o utilizada somente pelo Pr\xe9-validador -> ",(0,o.kt)("strong",{parentName:"p"},"U_MSCHVAL2"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"U_MSCHIMP(_cEmp)")," - Importador. Esta fun\xe7\xe3o tem como objetivo pegar os xml da pasta \\EMPRESA_XX\\aprovados\\ e realizar a importa\xe7\xe3o dos dados para as tabelas SZG, SZ1, SZ2, PW3 e PW4."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"CTExTable(uXml, cCodEmp, cCodFil, cMD5)")," - Fun\xe7\xe3o respons\xe1vel pela grava\xe7\xe3o das tabelas PW3, PW4 e PW5."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"FGravTab(clArqv,clRaiz,clDest,alChvVer,clCodFil, llEmitSK, lImpManual, cFileXml, _Brow )")," - Importa o XML para as tabelas necess\xe1rias com base (SZG, SZ1 e SZ2) nas informa\xe7\xf5es recebidas atrav\xe9s da fun\xe7\xe3o U_MSCHIMP"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"ForIsTrat(cCNPJ)")," - Retorna se a empresa \xe9 01 - Tratores"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"IsProdImportado(cCodProd)")," - Verifica se o produto \xe9 importado (considera SB1 da Tratores )"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("strong",{parentName:"p"},"Observa\xe7\xf5es")),(0,o.kt)("p",{parentName:"admonition"},"O Job do separador master deve conter a seguinte configura\xe7\xe3o:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre"},"[U_MSCHXML]\nMain=U_MSCHXML\nnParms=0\nEnvironment=PRODUCAO27 ;OU PRODUCAOSK       \n\n[ONSTART] \nJobs=U_MSCHXML\nRefreshRate=30\n")),(0,o.kt)("p",{parentName:"admonition"},"O Job pr\xe9-validador deve conter a seguinte configura\xe7\xe3o:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre"},"[U_MSCHVAL2_XX]\nMain=U_MSCHVAL2\nnParms=1\nParm1=XX -> Empresa\nEnvironment=PRODUCAO27 ;OU PRODUCAOSK   \n\n[ONSTART] \nJobs=U_MSCHVAL2_XX\nRefreshRate=30  \n")),(0,o.kt)("p",{parentName:"admonition"},"O Job importador deve contar a seguinte configura\xe7\xe3o:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre"},"[U_MSCHIMP_XX]\nMain=U_MSCHIMP\nnParms=1\nParm1=XX -> Empresa\nEnvironment=PRODUCAO27 ;OU PRODUCAOSK\n\n[ONSTART] \nJobs=U_MSCHIMP_XX\nRefreshRate=30  \n"))),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"configura\xe7\xf5es-dos-jobs-por-completo"},(0,o.kt)("strong",{parentName:"h3"},"Configura\xe7\xf5es dos JOBS por completo")),(0,o.kt)("hr",null),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[U_MSCHXML]\nMain=U_MSCHXML\nnParms=0\nEnvironment=PRODUCAO27\n\n[U_MSCHVAL2_01]\nMain=U_MSCHVAL2\nnParms=1\nParm1=01\nEnvironment=PRODUCAO27\n\n[U_MSCHVAL2_03]\nMain=U_MSCHVAL2\nnParms=1\nParm1=03\nEnvironment=PRODUCAO27\n\n[U_MSCHVAL2_04]\nMain=U_MSCHVAL2\nnParms=1\nParm1=04\nEnvironment=PRODUCAO27              \n            \n[U_MSCHVAL2_06]\nMain=U_MSCHVAL2\nnParms=1\nParm1=06\nEnvironment=PRODUCAO27\n\n[U_MSCHVAL2_08]\nMain=U_MSCHVAL2\nnParms=1\nParm1=08\nEnvironment=PRODUCAO27\n\n[U_MSCHVAL2_11]\nMain=U_MSCHVAL2\nnParms=1\nParm1=11\nEnvironment=PRODUCAO27\n\n[U_MSCHVAL2_23]\nMain=U_MSCHVAL2\nnParms=1\nParm1=23\nEnvironment=PRODUCAO27\n\n[U_MSCHVAL2_24]\nMain=U_MSCHVAL2\nnParms=1\nParm1=24\nEnvironment=PRODUCAO27  \n\n[U_MSCHIMP_01]\nMain=U_MSCHIMP\nnParms=1\nParm1=01\nEnvironment=PRODUCAO27\n\n[U_MSCHIMP_03]\nMain=U_MSCHIMP\nnParms=1\nParm1=03\nEnvironment=PRODUCAO27  \n\n[U_MSCHIMP_04]\nMain=U_MSCHIMP\nnParms=1\nParm1=04\nEnvironment=PRODUCAO27  \n    \n[U_MSCHIMP_06]\nMain=U_MSCHIMP\nnParms=1\nParm1=06\nEnvironment=PRODUCAO27\n\n[U_MSCHIMP_08]\nMain=U_MSCHIMP\nnParms=1\nParm1=08\nEnvironment=PRODUCAO27  \n\n[U_MSCHIMP_11]\nMain=U_MSCHIMP\nnParms=1\nParm1=11\nEnvironment=PRODUCAO27\n\n[U_MSCHIMP_23]\nMain=U_MSCHIMP\nnParms=1\nParm1=23\nEnvironment=PRODUCAO27\n\n[U_MSCHIMP_24]\nMain=U_MSCHIMP\nnParms=1\nParm1=24\nEnvironment=PRODUCAO27\n\n[U_Schleg01]\nMain=U_Schleg01\nEnvironment=PRODUCAO27\n\n[U_Schleg03]\nMain=U_Schleg03\nEnvironment=PRODUCAO27                                                              \n\n[U_Schleg04]\nMain=U_Schleg04\nEnvironment=PRODUCAO27\n\n[U_Schleg06]\nMain=U_Schleg06\nEnvironment=PRODUCAO27\n\n[U_Schleg08]\nMain=U_Schleg08\nEnvironment=PRODUCAO27  \n\n[U_Schleg11]\nMain=U_Schleg11\nEnvironment=PRODUCAO27  \n\n[U_Schleg23]\nMain=U_Schleg23\nEnvironment=PRODUCAO27  \n\n[U_Schleg24]\nMain=U_Schleg24\nEnvironment=PRODUCAO27          \n\n[ONSTART] \nJobs=U_MSCHXML,U_MSCHVAL2_01, U_MSCHVAL2_03, U_MSCHVAL2_04, U_MSCHVAL2_06, U_MSCHVAL2_08, U_MSCHVAL2_11, U_MSCHVAL2_23, U_MSCHVAL2_24,U_MSCHIMP_01,U_MSCHIMP_03, U_MSCHIMP_04, U_MSCHIMP_06, U_MSCHIMP_08, U_MSCHIMP_11, U_MSCHIMP_23, U_MSCHIMP_24, U_Schleg01, U_Schleg03, U_Schleg04, U_Schleg06, U_Schleg08, U_Schleg11, U_Schleg23, U_Schleg24\nRefreshRate=30\n")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"funcionamento"},(0,o.kt)("strong",{parentName:"h3"},"Funcionamento")),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Para o devido funcionamento dos jobs que realizar\xe3o a valida\xe7\xe3o/importa\xe7\xe3o do XML's, todos os arquivos devem estar na pasta pendentes dentro de: ",(0,o.kt)("strong",{parentName:"p"},"\\interf\\tse\\pendentes")),(0,o.kt)("p",null,"Todas as pastas de depend\xeancia dos jobs ser\xe3o criadas automaticamente."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Funcionamento visual",src:a(4390).Z,width:"1034",height:"839"})))}d.isMDXComponent=!0},4390:(n,e,a)=>{a.d(e,{Z:()=>r});const r=a.p+"assets/images/mschxml_UML-bcf1356fd4fb82bdd8aabe02195e1c17.webp"}}]);